require("ctrlrTestUtils")
require("Logger")
require("MockPanel")
require("MockTimer")
require("model/RolandJV1080Patch")
require("service/MidiService")
require("controller/RolandJV1080Controller")
require("controller/RolandJV1080ControllerAutogen")
require("controller/onPanelBeforeLoad")
require 'lunity'
require 'lemock'
module( 'RolandJV1080ControllerTest', lunity )

local log = Logger("RolandJV1080ControllerTest")

local modulatorMap = {
  ["PortamentoType"] = 0,
  ["FineTune4"] = 0,
  ["DelayMode4"] = 0,
  ["Lfo3bFadeTime"] = 0,
  ["Lfo2aExternalClock"] = 0,
  ["Amp1VelocityOnSense-1"] = 0,
  ["Lfo2bFadeTime"] = 0,
  ["Lfo2aKeyTrigger"] = 0,
  ["modulator-102"] = 0,
  ["Velocity4Low"] = 0,
  ["Lfo1aRate"] = 0,
  ["Lfo2bAmpDepth"] = 0,
  ["Lfo3aKeyTrigger"] = 0,
  ["FxmDepth1"] = 0,
  ["Lfo2bRate"] = 0,
  ["AmpLevel3-2"] = 0,
  ["Amp2VelocitySense"] = 0,
  ["FilterTime2-3"] = 0,
  ["Filter1Resonance"] = 0,
  ["modulator-21"] = 0,
  ["FxmToggle4"] = 0,
  ["FilterTime3-3"] = 0,
  ["CourseTune4"] = 0,
  ["Velocity1Low"] = 0,
  ["modulator-63"] = 0,
  ["Amp1VelocitySense-1"] = 0,
  ["Filter2VelocityDepth"] = 0,
  ["PitchLevel3-1"] = 0,
  ["Lfo4aRate"] = 0,
  ["Tone3DelayTime"] = 0,
  ["FilterTime2-4"] = 0,
  ["Filter4VelocityCurve"] = 0,
  ["modulator-28"] = 0,
  ["PortamentoToggle"] = 0,
  ["Filter1VelocityOffSense"] = 0,
  ["Filter4Resonance"] = 0,
  ["Lfo1bRate-1"] = 0,
  ["PitchLevel2-4"] = 0,
  ["modulator-57"] = 0,
  ["Filter3VelocityOnSense"] = 0,
  ["PatchLevel"] = 0,
  ["VelocityXfd3"] = 0,
  ["PitchLevel4-2"] = 0,
  ["Lfo1aKeyTrigger"] = 0,
  ["Key2High"] = 0,
  ["Filter2CutoffKeyFollow"] = 0,
  ["Lfo3aPitchDepth"] = 0,
  ["Lfo1bFadeTime-1"] = 0,
  ["Amp3VelocityCurve"] = 0,
  ["modulator-65"] = 0,
  ["EffectControlDepth1"] = 0,
  ["Type3"] = 0,
  ["AltDepth2"] = 0,
  ["M-10"] = 0,
  ["Filter1Cutoff"] = 0,
  ["Lfo1bDelay"] = 0,
  ["modulator-61"] = 0,
  ["Filter2VelocitySense"] = 0,
  ["Amp2KeyFollow"] = 0,
  ["AltDepth1-1"] = 0,
  ["FilterLevel4-4"] = 0,
  ["Lfo1aPitchDepth"] = 0,
  ["WaveGain2"] = 0,
  ["FilterLevel1-1"] = 0,
  ["Pitch2VelocityOnSense"] = 0,
  ["Lfo4bOffset"] = 0,
  ["FilterTime3-2"] = 0,
  ["Group4"] = 0,
  ["Tone2Toggle"] = 0,
  ["modulator-3"] = 0,
  ["Amp4VelocityOffSense"] = 0,
  ["FxmDepth3"] = 0,
  ["PortamentoStart"] = 0,
  ["Lfo2aPitchDepth"] = 0,
  ["Lfo4aKeyTrigger"] = 0,
  ["modulator-101"] = 0,
  ["Lfo4bWave"] = 0,
  ["M-19"] = 0,
  ["PanKeyFollow1"] = 0,
  ["PitchTime2-3"] = 0,
  ["modulator-38"] = 0,
  ["ToneOutput3"] = 0,
  ["Lfo1aFadeTime"] = 0,
  ["ToneLevel4"] = 0,
  ["Key4High"] = 0,
  ["CourseTune2"] = 0,
  ["HoldToggle2"] = 0,
  ["PitchLevel3-4"] = 0,
  ["Lfo1aKeyTrigger-1"] = 0,
  ["modulator-56"] = 0,
  ["modulator-95"] = 0,
  ["Lfo4bFadeTime"] = 0,
  ["PitchTime4-1"] = 0,
  ["Lfo2aFadeTime"] = 0,
  ["Key3Low"] = 0,
  ["Filter4Cutoff"] = 0,
  ["lblPhTtl"] = 0,
  ["AmpTime3-1"] = 0,
  ["Lfo3bDelay"] = 0,
  ["Lfo4bPitchDepth"] = 0,
  ["FilterLevel1-6"] = 0,
  ["STRUCTURE4"] = 0,
  ["Amp1BiasPoint"] = 0,
  ["Lfo1bExternalClock"] = 0,
  ["Pitch3VelocitySense"] = 0,
  ["Lfo3aFadeTime"] = 0,
  ["Amp3BiasPoint"] = 0,
  ["ToneOutput4"] = 0,
  ["PanControl4"] = 0,
  ["Pitch2EnvelopeDepth"] = 0,
  ["Lfo3bPitchDepth"] = 0,
  ["AmpTime1-3"] = 0,
  ["Lfo2aRate"] = 0,
  ["Lfo1aPanDepth-1"] = 0,
  ["Pan4"] = 0,
  ["FilterTime1-4"] = 0,
  ["FilterTime1-2"] = 0,
  ["Tone1Chorus"] = 0,
  ["VolumeToggle4"] = 0,
  ["AmpLevel4-2"] = 0,
  ["modulator-55"] = 0,
  ["FXParam6"] = 0,
  ["PanControl1"] = 0,
  ["Pitch1VelocityOnSense"] = 0,
  ["AmpTime4-3"] = 0,
  ["Amp4KeyFollow"] = 0,
  ["Tone4DelayTime"] = 0,
  ["FineTune3"] = 0,
  ["AmpTime3-2"] = 0,
  ["Lfo4aFilterDepth"] = 0,
  ["PitchLevel1-5"] = 0,
  ["AmpLevel1-4"] = 0,
  ["AmpLevel4-1"] = 0,
  ["Lfo3bOffset"] = 0,
  ["M-16"] = 0,
  ["BenderToggle1-1"] = 0,
  ["modulator-68"] = 0,
  ["Filter3ResSense"] = 0,
  ["Filter1Cutoff-1"] = 0,
  ["Amp4BiasPoint"] = 0,
  ["Lfo1aExternalClock"] = 0,
  ["VolumeToggle2"] = 0,
  ["Amp3VelocityOffSense"] = 0,
  ["BenderToggle4"] = 0,
  ["AmpLevel3-1"] = 0,
  ["PitchLevel4-4"] = 0,
  ["M-9"] = 0,
  ["Lfo3aWave"] = 0,
  ["modulator-14"] = 0,
  ["PitchLevel1-8"] = 0,
  ["modulator-9"] = 0,
  ["Filter1ResSense-1"] = 0,
  ["Lfo1bDelay-1"] = 0,
  ["Filter3VelocityCurve"] = 0,
  ["ToneOutput1"] = 0,
  ["Color2"] = 0,
  ["Legato"] = 0,
  ["FilterLevel2-3"] = 0,
  ["CourseTune1-1"] = 0,
  ["M-8"] = 0,
  ["Pitch3KeyFollow"] = 0,
  ["PitchLevel1-2"] = 0,
  ["Pitch2VelocityOffSense"] = 0,
  ["Amp2VelocityOffSense"] = 0,
  ["FXParam5"] = 0,
  ["Lfo1aFadeMode"] = 0,
  ["Lfo4bKeyTrigger"] = 0,
  ["Pan2"] = 0,
  ["modulator-31"] = 0,
  ["Tone4Toggle"] = 0,
  ["Lfo4aExternalClock"] = 0,
  ["PitchLevel3-3"] = 0,
  ["Lfo1bPanDepth"] = 0,
  ["AmpTime2-3"] = 0,
  ["PanControl3"] = 0,
  ["Amp2BiasDirection"] = 0,
  ["WaveGain1-1"] = 0,
  ["Pitch4EnvelopeDepth"] = 0,
  ["AmpLevel1-3"] = 0,
  ["Amp1BiasLevel"] = 0,
  ["FilterTime4-3"] = 0,
  ["FxmToggle1"] = 0,
  ["ChorusLevel"] = 0,
  ["Lfo1aDelay"] = 0,
  ["FilterLevel3-2"] = 0,
  ["modulator-15"] = 0,
  ["RedampToggle2"] = 0,
  ["Lfo1aOffset-1"] = 0,
  ["type2"] = 0,
  ["modulator-149"] = 0,
  ["Stretch"] = 0,
  ["Boost1-2"] = 0,
  ["WaveGain3"] = 0,
  ["Amp4VelocityCurve"] = 0,
  ["M-12"] = 0,
  ["Filter3VelocityDepth"] = 0,
  ["M-14"] = 0,
  ["DelayMode2"] = 0,
  ["ToneLevel1"] = 0,
  ["Lfo1aWave"] = 0,
  ["Lfo4aPitchDepth"] = 0,
  ["Color3"] = 0,
  ["PitchLevel1-4"] = 0,
  ["Amp1VelocityOnSense"] = 0,
  ["PitchLevel2-3"] = 0,
  ["Filter3Type"] = 0,
  ["PitchLevel3-2"] = 0,
  ["Filter1VelocityCurve"] = 0,
  ["PanKeyFollow2"] = 0,
  ["Lfo4bFadeMode"] = 0,
  ["PanRandom3"] = 0,
  ["FxmDepth4"] = 0,
  ["ReverbType"] = 0,
  ["FilterLevel4-1"] = 0,
  ["modulator-39"] = 0,
  ["modulator-48"] = 0,
  ["Amp1VelocityOffSense"] = 0,
  ["Type1"] = 0,
  ["AltDepth4"] = 0,
  ["Lfo2aFilterDepth"] = 0,
  ["M-246"] = 0,
  ["PanRandom4"] = 0,
  ["Wave4"] = 0,
  ["FilterTime2-2"] = 0,
  ["modulator-25"] = 0,
  ["Filter2VelocityOnSense"] = 0,
  ["VelocityRange"] = 0,
  ["Velocity3Low"] = 0,
  ["RedampToggle4"] = 0,
  ["Velocity1High"] = 0,
  ["Tone1DelayTime"] = 0,
  ["FXParam2"] = 0,
  ["Lfo1bPitchDepth"] = 0,
  ["Filter1KeyFollow"] = 0,
  ["Lfo4aPanDepth"] = 0,
  ["Lfo1bPanDepth-1"] = 0,
  ["BenderToggle1"] = 0,
  ["PitchTime4-4"] = 0,
  ["PitchLevel2-2"] = 0,
  ["Lfo4aAmpDepth"] = 0,
  ["FxmToggle2"] = 0,
  ["modulator-43"] = 0,
  ["modulator-20"] = 0,
  ["CourseTune1"] = 0,
  ["FilterTime1-1"] = 0,
  ["Lfo3aDelay"] = 0,
  ["AmpTime1-7"] = 0,
  ["PitchTime1-1"] = 0,
  ["Lfo1bFadeMode"] = 0,
  ["Lfo2aOffset"] = 0,
  ["Tone4Reverb"] = 0,
  ["PitchTime3-1"] = 0,
  ["Filter1VelocityDepth-1"] = 0,
  ["modulator-8"] = 0,
  ["Pitch1KeyFollow"] = 0,
  ["PitchRandom1-1"] = 0,
  ["ChorusPreDelay"] = 0,
  ["Boost1-4"] = 0,
  ["modulator-50"] = 0,
  ["Lfo4bPanDepth"] = 0,
  ["Key3High"] = 0,
  ["AmpTime2-2"] = 0,
  ["Lfo2bPanDepth"] = 0,
  ["Lfo1bAmpDepth-1"] = 0,
  ["ChorusFeedback"] = 0,
  ["Wave1Incremental"] = 0,
  ["FilterTime3-4"] = 0,
  ["Velocity4High"] = 0,
  ["Lfo1bWave-1"] = 0,
  ["FilterTime1-3"] = 0,
  ["Lfo3aExternalClock"] = 0,
  ["Boost3-6"] = 0,
  ["Pitch3VelocityOnSense"] = 0,
  ["ReverbTime"] = 0,
  ["Velocity2Low"] = 0,
  ["Key1High-1"] = 0,
  ["Tone3Reverb"] = 0,
  ["FilterLevel3-4"] = 0,
  ["modulator-1"] = 0,
  ["Filter1Type"] = 0,
  ["Lfo2aAmpDepth"] = 0,
  ["modulator-19"] = 0,
  ["Tone2Reverb"] = 0,
  ["Velocity1Low-1"] = 0,
  ["AmpTime1-6"] = 0,
  ["AmpTime4-2"] = 0,
  ["Tone2OutputLevel"] = 0,
  ["VolumeToggle1-1"] = 0,
  ["Tone1DelayTime-1"] = 0,
  ["Filter2Cutoff"] = 0,
  ["ToneLevel2"] = 0,
  ["Lfo1bAmpDepth"] = 0,
  ["Lfo4bExternalClock"] = 0,
  ["Tone2Chorus"] = 0,
  ["Lfo1aPitchDepth-1"] = 0,
  ["EffectControlSource1"] = 0,
  ["Lfo3aRate"] = 0,
  ["PitchLevel1-6"] = 0,
  ["modulator-51"] = 0,
  ["PitchRandom4"] = 0,
  ["Pitch4KeyFollow"] = 0,
  ["Pitch1EnvelopeDepth"] = 0,
  ["AmpTime4-4"] = 0,
  ["Key2Low"] = 0,
  ["PitchTime2-1"] = 0,
  ["AltDepth3"] = 0,
  ["modulator-40"] = 0,
  ["PitchTime4-2"] = 0,
  ["AnalogFeel"] = 0,
  ["PitchRandom3"] = 0,
  ["STRUCTURE3"] = 0,
  ["Filter4Type"] = 0,
  ["M-250"] = 0,
  ["Filter4VelocityOnSense"] = 0,
  ["modulator-7"] = 0,
  ["Group3"] = 0,
  ["Amp3VelocityOnSense"] = 0,
  ["Lfo4aOffset"] = 0,
  ["Pitch3EnvelopeDepth"] = 0,
  ["Color1"] = 0,
  ["HoldToggle1-1"] = 0,
  ["PanKeyFollow4"] = 0,
  ["Lfo1bExternalClock-1"] = 0,
  ["PanControl1-1"] = 0,
  ["STRUCTURE1"] = 0,
  ["Lfo1bKeyTrigger-1"] = 0,
  ["FineTune1"] = 0,
  ["Pitch1VelocitySense-1"] = 0,
  ["Lfo1aAmpDepth-1"] = 0,
  ["AmpTime3-4"] = 0,
  ["Lfo1bWave"] = 0,
  ["AmpLevel3-3"] = 0,
  ["EffectLevel"] = 0,
  ["Lfo1aFilterDepth-1"] = 0,
  ["Lfo1aExternalClock-1"] = 0,
  ["Lfo1aFadeMode-1"] = 0,
  ["Tone3OutputLevel"] = 0,
  ["Lfo1aFadeTime-1"] = 0,
  ["modulator-47"] = 0,
  ["Lfo1aDelay-1"] = 0,
  ["AmpLevel1-2"] = 0,
  ["Lfo1aRate-1"] = 0,
  ["Lfo1aWave-1"] = 0,
  ["EffectOutput"] = 0,
  ["modulator-67"] = 0,
  ["Pan3"] = 0,
  ["Lfo1bFadeMode-1"] = 0,
  ["PanRandom1-1"] = 0,
  ["PanKeyFollow1-1"] = 0,
  ["FilterLevel3-1"] = 0,
  ["MainReverbLevel"] = 0,
  ["Key1Low-1"] = 0,
  ["PitchTime1-4"] = 0,
  ["Velocity1High-1"] = 0,
  ["VelocityXfd1-1"] = 0,
  ["Tone1Chorus-1"] = 0,
  ["Key1Low"] = 0,
  ["Amp1VelocityCurve-1"] = 0,
  ["PanRandom2"] = 0,
  ["modulator-60"] = 0,
  ["Tone1OutputLevel-1"] = 0,
  ["ToneOutput1-1"] = 0,
  ["ToneOutput2"] = 0,
  ["WaveGain1"] = 0,
  ["DelayMode1-1"] = 0,
  ["Filter3VelocitySense"] = 0,
  ["Tone1Reverb-1"] = 0,
  ["modulator-66"] = 0,
  ["Filter1VelocityDepth"] = 0,
  ["Priority"] = 0,
  ["Assign"] = 0,
  ["Lfo1bPitchDepth-1"] = 0,
  ["Pitch1VelocityOnSense-1"] = 0,
  ["AltDepth1"] = 0,
  ["Pitch1KeyFollow-2"] = 0,
  ["Pitch1EnvelopeDepth-1"] = 0,
  ["Lfo1aOffset-2"] = 0,
  ["Pitch1KeyFollow-1"] = 0,
  ["FineTune1-1"] = 0,
  ["PitchLevel1-7"] = 0,
  ["PitchTime1-8"] = 0,
  ["PitchTime1-7"] = 0,
  ["modulator-32"] = 0,
  ["PitchTime1-6"] = 0,
  ["PatchTempo"] = 0,
  ["Pitch1VelocitySense"] = 0,
  ["Filter4KeyFollow"] = 0,
  ["Filter2Resonance"] = 0,
  ["Filter1VelocitySense-1"] = 0,
  ["FilterLevel3-3"] = 0,
  ["AmpLevel4-3"] = 0,
  ["FxmDepth1-1"] = 0,
  ["Filter4VelocityOffSense"] = 0,
  ["Filter1KeyFollow-1"] = 0,
  ["Filter1CutoffKeyFollow-1"] = 0,
  ["FilterLevel1-7"] = 0,
  ["Filter1VelocityCurve-1"] = 0,
  ["PanControl2"] = 0,
  ["PatchSelect"] = 0,
  ["FilterLevel4-3"] = 0,
  ["M-308"] = 0,
  ["Lfo3bPanDepth"] = 0,
  ["Filter1Type-1"] = 0,
  ["FilterLevel1-8"] = 0,
  ["Filter1Resonance-1"] = 0,
  ["FilterLevel1-5"] = 0,
  ["FXParam4"] = 0,
  ["PitchTime3-2"] = 0,
  ["FilterTime1-7"] = 0,
  ["RedampToggle1"] = 0,
  ["AmpTime2-1"] = 0,
  ["FilterTime1-6"] = 0,
  ["Boost3-4"] = 0,
  ["Lfo3bRate"] = 0,
  ["Octave"] = 0,
  ["Lfo4aWave"] = 0,
  ["FilterTime1-5"] = 0,
  ["Amp2VelocityOnSense"] = 0,
  ["PortamentoTime"] = 0,
  ["Amp1BiasDirection-1"] = 0,
  ["Amp1BiasPoint-1"] = 0,
  ["HoldToggle4"] = 0,
  ["Group1-1"] = 0,
  ["Lfo3aAmpDepth"] = 0,
  ["AmpLevel1-6"] = 0,
  ["Wave4Incremental"] = 0,
  ["AmpLevel1-5"] = 0,
  ["AmpTime1-8"] = 0,
  ["Tone1Toggle-1"] = 0,
  ["Filter1VelocityOnSense-1"] = 0,
  ["Lfo3aPanDepth"] = 0,
  ["Wave3Incremental"] = 0,
  ["Wave1-1"] = 0,
  ["Group1"] = 0,
  ["Velocity3High"] = 0,
  ["ToneLevel1-1"] = 0,
  ["Color1-1"] = 0,
  ["Type1-1"] = 0,
  ["FXParam11"] = 0,
  ["PanRandom1"] = 0,
  ["TempoIncremental"] = 0,
  ["Filter3CutoffKeyFollow"] = 0,
  ["Wave2Incremental"] = 0,
  ["Boost3-5"] = 0,
  ["VelocityXfd1"] = 0,
  ["FxControl"] = 0,
  ["Lfo1aAmpDepth"] = 0,
  ["modulator-59"] = 0,
  ["Amp4BiasDirection"] = 0,
  ["Pitch1VelocityOffSense"] = 0,
  ["Amp3BiasDirection"] = 0,
  ["Amp2BiasPoint"] = 0,
  ["PitchTime1-3"] = 0,
  ["Lfo1aPanDepth"] = 0,
  ["Filter2VelocityCurve"] = 0,
  ["Filter2Type"] = 0,
  ["EffectControlSource2"] = 0,
  ["PitchLevel2-1"] = 0,
  ["Amp3KeyFollow"] = 0,
  ["M-13"] = 0,
  ["Lfo3bAmpDepth"] = 0,
  ["FilterTime4-2"] = 0,
  ["FXParam10"] = 0,
  ["Key4Low"] = 0,
  ["modulator-62"] = 0,
  ["FXParam12"] = 0,
  ["FXParam8"] = 0,
  ["EffectType"] = 0,
  ["FilterLevel1-4"] = 0,
  ["M-15"] = 0,
  ["Pan1-1"] = 0,
  ["AmpLevel1-1"] = 0,
  ["modulator-29"] = 0,
  ["Tone4Chorus"] = 0,
  ["FXParam1"] = 0,
  ["Filter2KeyFollow"] = 0,
  ["lblPhTtl-1"] = 0,
  ["M-6"] = 0,
  ["FxmToggle3"] = 0,
  ["Filter4VelocityDepth"] = 0,
  ["AmpTime1-5"] = 0,
  ["Lfo1bRate"] = 0,
  ["AmpTime1-2"] = 0,
  ["modulator-54"] = 0,
  ["AmpLevel2-2"] = 0,
  ["modulator-53"] = 0,
  ["modulator-52"] = 0,
  ["DelayMode1"] = 0,
  ["Filter4VelocitySense"] = 0,
  ["modulator-49"] = 0,
  ["FilterLevel2-4"] = 0,
  ["modulator-46"] = 0,
  ["FXParam7"] = 0,
  ["modulator-44"] = 0,
  ["Filter1VelocitySense"] = 0,
  ["Lfo1aFilterDepth"] = 0,
  ["modulator-42"] = 0,
  ["modulator-41"] = 0,
  ["Color4"] = 0,
  ["MainChorusLevel"] = 0,
  ["Amp4VelocityOnSense"] = 0,
  ["modulator-93"] = 0,
  ["modulator-2"] = 0,
  ["PitchTime2-2"] = 0,
  ["modulator-37"] = 0,
  ["WaveGain4"] = 0,
  ["modulator-35"] = 0,
  ["PitchRandom2"] = 0,
  ["modulator-34"] = 0,
  ["RedampToggle3"] = 0,
  ["modulator-26"] = 0,
  ["Filter3VelocityOffSense"] = 0,
  ["PitchBendDown"] = 0,
  ["FilterTime4-4"] = 0,
  ["Lfo2aWave"] = 0,
  ["modulator-30"] = 0,
  ["AmpLevel2-1"] = 0,
  ["Key1High"] = 0,
  ["M-248"] = 0,
  ["modulator-16"] = 0,
  ["modulator-151"] = 0,
  ["ChorusDepth"] = 0,
  ["FxmDepth2"] = 0,
  ["Amp3BiasLevel"] = 0,
  ["modulator-114"] = 0,
  ["Pan1"] = 0,
  ["Lfo2bOffset"] = 0,
  ["Pitch4VelocityOffSense"] = 0,
  ["modulator-13"] = 0,
  ["modulator-27"] = 0,
  ["modulator-33"] = 0,
  ["Lfo2bDelay"] = 0,
  ["Group2"] = 0,
  ["Lfo1bKeyTrigger"] = 0,
  ["M-245"] = 0,
  ["PitchTime4-3"] = 0,
  ["Pitch4VelocitySense"] = 0,
  ["HoldToggle3"] = 0,
  ["Lfo2bExternalClock"] = 0,
  ["M-247"] = 0,
  ["Tone3Chorus"] = 0,
  ["Pitch4VelocityOnSense"] = 0,
  ["Lfo4aDelay"] = 0,
  ["modulator-17"] = 0,
  ["Filter2VelocityOffSense"] = 0,
  ["modulator-112"] = 0,
  ["modulator-5"] = 0,
  ["Filter2ResSense"] = 0,
  ["modulator-24"] = 0,
  ["Amp2BiasLevel"] = 0,
  ["VolumeToggle1"] = 0,
  ["modulator-23"] = 0,
  ["modulator-22"] = 0,
  ["EffectControlSource2-1"] = 0,
  ["Lfo2bKeyTrigger"] = 0,
  ["PitchRandom1"] = 0,
  ["Wave2"] = 0,
  ["Lfo3bWave"] = 0,
  ["Lfo1aOffset"] = 0,
  ["modulator-45"] = 0,
  ["Lfo4aFadeMode"] = 0,
  ["PatchPan"] = 0,
  ["ToneLevel3"] = 0,
  ["Amp1KeyFollow"] = 0,
  ["DelayMode3"] = 0,
  ["Amp2VelocityCurve"] = 0,
  ["FilterTime3-1"] = 0,
  ["Lfo1bPitchDepth-2"] = 0,
  ["PitchBendUp"] = 0,
  ["Lfo2bPitchDepth"] = 0,
  ["Filter1VelocityOnSense"] = 0,
  ["ReverbHighFreqDamp"] = 0,
  ["ReverbFeedback"] = 0,
  ["ReverbLevel"] = 0,
  ["Filter3Cutoff"] = 0,
  ["AmpTime4-1"] = 0,
  ["Amp4BiasLevel"] = 0,
  ["EffectControlDepth2"] = 0,
  ["modulator-64"] = 0,
  ["Lfo2bFadeMode"] = 0,
  ["FineTune2"] = 0,
  ["Pitch1VelocityOffSense-1"] = 0,
  ["ControlSource3"] = 0,
  ["ControlSource2"] = 0,
  ["PitchTime1-2"] = 0,
  ["FilterLevel4-2"] = 0,
  ["RedampToggle1-1"] = 0,
  ["FXParam9"] = 0,
  ["PitchLevel1-1"] = 0,
  ["Filter4ResSense"] = 0,
  ["PitchTime2-4"] = 0,
  ["BenderToggle3"] = 0,
  ["FXParam3"] = 0,
  ["CourseTune3"] = 0,
  ["M-249"] = 0,
  ["Tone1Toggle"] = 0,
  ["FilterLevel1-3"] = 0,
  ["FxmToggle1-1"] = 0,
  ["Lfo2aFadeMode"] = 0,
  ["LEVEL-1"] = 0,
  ["PortamentoMode"] = 0,
  ["Amp1KeyFollow-1"] = 0,
  ["AmpTime2-4"] = 0,
  ["Amp1BiasDirection"] = 0,
  ["AmpTime3-3"] = 0,
  ["modulator-104"] = 0,
  ["VolumeToggle3"] = 0,
  ["modulator-36"] = 0,
  ["Lfo4bAmpDepth"] = 0,
  ["Velocity2High"] = 0,
  ["Amp1VelocityCurve"] = 0,
  ["Lfo4bDelay"] = 0,
  ["Amp3VelocitySense"] = 0,
  ["Lfo3aOffset"] = 0,
  ["Tone4OutputLevel"] = 0,
  ["Wave1"] = 0,
  ["Lfo4bRate"] = 0,
  ["Filter1ResSense"] = 0,
  ["Type4"] = 0,
  ["Wave3"] = 0,
  ["modulator-6"] = 0,
  ["AmpTime1-4"] = 0,
  ["AmpTime1-1"] = 0,
  ["Lfo3bKeyTrigger"] = 0,
  ["Tone1Reverb"] = 0,
  ["Tone3Toggle"] = 0,
  ["Lfo3aFilterDepth"] = 0,
  ["FilterLevel2-1"] = 0,
  ["PanKeyFollow3"] = 0,
  ["PitchTime1-5"] = 0,
  ["Filter1CutoffKeyFollow"] = 0,
  ["Lfo3bExternalClock"] = 0,
  ["PitchTime3-4"] = 0,
  ["M-18"] = 0,
  ["modulator-18"] = 0,
  ["M-251"] = 0,
  ["ChorusRate"] = 0,
  ["Amp1BiasLevel-1"] = 0,
  ["Lfo3aFadeMode"] = 0,
  ["PitchLevel4-1"] = 0,
  ["M-7"] = 0,
  ["modulator-105"] = 0,
  ["modulator-4"] = 0,
  ["M-17"] = 0,
  ["Lfo2aDelay"] = 0,
  ["Filter4CutoffKeyFollow"] = 0,
  ["FilterLevel2-2"] = 0,
  ["Lfo4aFadeTime"] = 0,
  ["AmpLevel2-3"] = 0,
  ["Lfo2aPanDepth"] = 0,
  ["modulator-58"] = 0,
  ["M-11"] = 0,
  ["Wave1Incremental-1"] = 0,
  ["Lfo2bWave"] = 0,
  ["VelocityXfd2"] = 0,
  ["BenderToggle2"] = 0,
  ["Lfo1bFadeTime"] = 0,
  ["Tone2DelayTime"] = 0,
  ["PitchLevel4-3"] = 0,
  ["FilterTime4-1"] = 0,
  ["Pitch3VelocityOffSense"] = 0,
  ["modulator-103"] = 0,
  ["HoldToggle1"] = 0,
  ["Amp4VelocitySense"] = 0,
  ["Lfo3bFadeMode"] = 0,
  ["STRUCTURE2"] = 0,
  ["Filter1VelocityOffSense-1"] = 0,
  ["PitchTime3-3"] = 0,
  ["VelocityXfd4"] = 0,
  ["Pitch2KeyFollow"] = 0,
  ["Pitch2VelocitySense"] = 0,
  ["FilterTime1-8"] = 0,
  ["Amp1VelocitySense"] = 0,
  ["M-307"] = 0,
  ["PitchLevel1-3"] = 0,
  ["Filter3KeyFollow"] = 0,
  ["Tone1OutputLevel"] = 0,
  ["Filter3Resonance"] = 0,
  ["FilterLevel1-2"] = 0,
  ["Amp1VelocityOffSense-1"] = 0
}

function setup()
  local log = Logger("GLOBAL")
  log:setLevel(3)
  regGlobal("LOGGER", log)
  
  regGlobal("timer", MockTimer())

  --  midiMessages = {}
  --  local midiListener = function(midiMessage)
  --    table.insert(midiMessages, midiMessage)
  --  end
  --  regGlobal("panel", MockPanel("Roland-JV1080.panel", midiListener))
  --  onPanelBeforeLoad()
end

function teardown()
  delGlobal("midiService")
end

--function testOnPatchDroppedToPanel()
--  loadPatchFromFile("test/data/single.syx", panel, modulatorMap, "lblPhTtl", "1 Astral Chill")
--end

function testOnGetData()

  local msgIndex = 1
  local syxMsgs = {
    CtrlrMidiMessage(MemoryBlock("F0 41 10 6A 12 11 00 00 00 43 68 6F 72 75 73 20 43 6C 61 76 20 0A 00 05 7F 00 14 14 32 7F 00 00 00 00 00 7F 7F 00 02 40 02 62 7F 02 7F 00 00 02 07 22 7F 0C 24 07 08 73 40 00 02 02 00 00 00 00 01 01 1B 01 02 00 00 00 00 00 04 00 00 00 00 00 00 66 F7")),
    CtrlrMidiMessage(MemoryBlock("F0 41 10 6A 12 11 00 10 00 01 00 01 02 05 03 00 01 00 00 00 00 01 7F 00 7F 00 01 01 01 01 09 45 00 3F 00 3F 00 3F 02 49 03 47 04 3E 00 3F 04 47 00 3F 00 3F 00 3F 00 01 5B 02 00 00 00 00 00 01 41 02 00 00 00 00 24 32 00 0C 0C 32 07 07 07 00 00 00 00 7E 7E 7E 7E 3F 3F 01 3C 08 00 32 52 00 6C 07 07 08 00 09 4C 03 7F 62 00 75 3F 3F 7F 03 3C 07 00 52 07 07 08 00 01 5F 05 7F 74 00 3F 3F 40 0A 00 40 3F 3F 01 7F 00 00 57 F7")),
    CtrlrMidiMessage(MemoryBlock("F0 41 10 6A 12 11 00 12 00 00 00 01 02 05 01 00 01 00 00 00 00 01 7F 00 7F 00 01 01 01 01 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 01 41 02 00 00 00 00 00 01 41 02 00 00 00 00 30 32 00 0C 0C 32 07 07 07 00 00 00 00 7E 7E 7E 7E 3F 3F 01 3C 08 00 32 4F 00 49 07 07 08 00 28 37 03 7F 37 00 69 3F 3F 62 03 3C 07 00 67 07 07 08 00 2D 47 05 7F 6F 00 3F 3F 40 0A 00 40 3F 3F 00 7F 74 6E 06 F7")),
    CtrlrMidiMessage(MemoryBlock("F0 41 10 6A 12 11 00 14 00 00 00 01 02 05 01 00 01 00 00 00 00 01 7F 00 7F 00 01 01 01 01 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 01 41 02 00 00 00 00 00 01 41 02 00 00 00 00 18 32 00 0C 0C 32 07 07 07 00 00 00 00 7E 7E 7E 7E 3F 3F 01 3C 08 00 32 4F 00 49 07 07 08 00 28 37 03 7F 37 00 69 3F 3F 3B 03 3C 07 00 67 07 07 08 00 2D 47 05 7F 6F 00 3F 3F 40 0A 00 40 3F 3F 00 7F 74 6E 43 F7")),
    CtrlrMidiMessage(MemoryBlock("F0 41 10 6A 12 11 00 16 00 00 00 01 02 05 01 00 01 00 00 00 00 01 7F 00 7F 00 01 01 01 01 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 3F 00 01 41 02 00 00 00 00 00 01 41 02 00 00 00 00 24 32 00 0C 0C 32 07 07 07 00 00 00 00 7E 7E 7E 7E 3F 3F 01 5A 08 00 32 4F 00 49 07 07 08 00 28 37 03 7F 37 00 69 3F 3F 49 03 3C 07 00 67 07 07 08 00 2D 47 05 7F 6F 00 3F 3F 40 0A 00 40 3F 3F 00 7F 74 6E 09 F7")),
  }

  local p = MockPanel("Roland-JV1080.panel", nil)
  regGlobal("panel", p)
  onPanelBeforeLoad()

  local tested = RolandJV1080Controller()

  local midiListener = function(midiMessage)
    tested:onMidiReceived(table.remove(syxMsgs))
  end
  p:setMidiListener(midiListener)

  tested:onGetData()
  
  assertEqual(table.getn(syxMsgs), 0)
end

runTests{useANSI = false}
